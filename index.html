<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä Sistema Vendas Simples</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f5f5f5; }
        
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { background: #2c3e50; color: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .nav { display: flex; gap: 15px; margin-top: 15px; }
        .nav button { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; }
        
        .page { display: none; }
        .page.active { display: block; }
        
        .card { background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .card h2 { margin-bottom: 15px; color: #2c3e50; }
        
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; color: #555; }
        .form-group input, .form-group select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        
        button { background: #3498db; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #2980b9; }
        .btn-success { background: #27ae60; }
        .btn-danger { background: #e74c3c; }
        
        table { width: 100%; border-collapse: collapse; background: white; border-radius: 10px; overflow: hidden; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: #34495e; color: white; }
        tr:hover { background: #f9f9f9; }
        
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .stat-card { background: white; padding: 20px; border-radius: 10px; text-align: center; }
        .stat-value { font-size: 32px; font-weight: bold; color: #2c3e50; }
        .stat-label { color: #7f8c8d; margin-top: 5px; }
        
        .alert { padding: 15px; border-radius: 5px; margin-bottom: 20px; display: none; }
        .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .alert-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <div class="header">
            <h1>üìä Sistema de Vendas</h1>
            <div class="nav">
                <button onclick="showPage('dashboard')">Dashboard</button>
                <button onclick="showPage('produtos')">Produtos</button>
                <button onclick="showPage('vendas')">Vendas</button>
                <button onclick="sincronizar()">üîÑ Sincronizar</button>
            </div>
        </div>
        
        <!-- ALERTAS -->
        <div class="alert alert-success" id="alertSuccess"></div>
        <div class="alert alert-error" id="alertError"></div>
        
        <!-- DASHBOARD -->
        <div class="page active" id="pageDashboard">
            <div class="card">
                <h2>üìà Dashboard</h2>
                <div style="margin-bottom: 20px;">
                    <button onclick="carregarDashboard('hoje')">Hoje</button>
                    <button onclick="carregarDashboard('semana')">Esta Semana</button>
                    <button onclick="carregarDashboard('mes')">Este M√™s</button>
                </div>
                
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-value" id="totalVendas">0</div>
                        <div class="stat-label">Vendas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="faturamento">R$ 0</div>
                        <div class="stat-label">Faturamento</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="ticketMedio">R$ 0</div>
                        <div class="stat-label">Ticket M√©dio</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalProdutos">0</div>
                        <div class="stat-label">Produtos</div>
                    </div>
                </div>
                
                <h3 style="margin-top: 30px;">üèÜ Produtos Mais Vendidos</h3>
                <div id="topProdutos" style="margin-top: 15px;">
                    Carregando...
                </div>
            </div>
        </div>
        
        <!-- PRODUTOS -->
        <div class="page" id="pageProdutos">
            <div class="card">
                <h2>üì¶ Cadastrar Produto</h2>
                <div class="form-group">
                    <label>Nome do Produto</label>
                    <input type="text" id="produtoNome" placeholder="Ex: Pizza Grande">
                </div>
                <div class="form-group">
                    <label>Quantidade em Estoque</label>
                    <input type="number" id="produtoQuantidade" value="0">
                </div>
                <div class="form-group">
                    <label>Pre√ßo de Venda (R$)</label>
                    <input type="number" step="0.01" id="produtoPreco">
                </div>
                <button onclick="cadastrarProduto()" class="btn-success">üíæ Salvar Produto</button>
            </div>
            
            <div class="card">
                <h2>üìã Lista de Produtos</h2>
                <div id="listaProdutos">
                    Carregando produtos...
                </div>
            </div>
        </div>
        
        <!-- VENDAS -->
        <div class="page" id="pageVendas">
            <div class="card">
                <h2>üõí Registrar Venda</h2>
                <div class="form-group">
                    <label>Produto</label>
                    <select id="vendaProduto" onchange="selecionarProduto()">
                        <option value="">Selecione um produto</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Quantidade</label>
                    <input type="number" id="vendaQuantidade" value="1" min="1">
                </div>
                <div class="form-group">
                    <label>Pre√ßo Unit√°rio</label>
                    <input type="text" id="vendaPrecoUnitario" readonly>
                </div>
                <div class="form-group">
                    <label>Total da Venda</label>
                    <input type="text" id="vendaTotal" readonly style="font-size: 18px; font-weight: bold;">
                </div>
                <button onclick="registrarVenda()" class="btn-success">‚úÖ Finalizar Venda</button>
            </div>
            
            <div class="card">
                <h2>üìã Hist√≥rico de Vendas</h2>
                <div id="listaVendas">
                    Carregando vendas...
                </div>
            </div>
        </div>
    </div>

    <script>
        // ================= CONFIG =================
        const CONFIG = {
            API_URL: 'https://an-lise.vercel.app/api',
            MODO_DEMO: false
        };
        
        let produtos = [];
        
        // ================= NAVEGA√á√ÉO =================
        function showPage(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page' + page.charAt(0).toUpperCase() + page.slice(1)).classList.add('active');
            
            if (page === 'dashboard') carregarDashboard('hoje');
            if (page === 'produtos') carregarProdutos();
            if (page === 'vendas') {
                carregarProdutosParaVenda();
                carregarVendas();
            }
        }
        
        function showAlert(type, message) {
            const alert = document.getElementById('alert' + type.charAt(0).toUpperCase() + type.slice(1));
            alert.textContent = message;
            alert.style.display = 'block';
            setTimeout(() => alert.style.display = 'none', 3000);
        }
        
        // ================= DASHBOARD =================
        async function carregarDashboard(periodo) {
            try {
                const response = await fetch(`${CONFIG.API_URL}/dashboard?periodo=${periodo}`);
                const data = await response.json();
                
                document.getElementById('totalVendas').textContent = data.vendas.total;
                document.getElementById('faturamento').textContent = `R$ ${data.vendas.faturamento.toFixed(2)}`;
                document.getElementById('ticketMedio').textContent = `R$ ${data.vendas.ticket_medio.toFixed(2)}`;
                document.getElementById('totalProdutos').textContent = data.produtos.total;
                
                // Top produtos
                let html = '<table>';
                data.top_produtos.forEach(prod => {
                    html += `
                        <tr>
                            <td>${prod.produto_nome}</td>
                            <td>${prod.total_vendido} unidades</td>
                            <td>R$ ${prod.faturamento.toFixed(2)}</td>
                        </tr>
                    `;
                });
                html += '</table>';
                document.getElementById('topProdutos').innerHTML = html;
                
            } catch (error) {
                console.error('Erro dashboard:', error);
                showAlert('error', 'Erro ao carregar dashboard');
            }
        }
        
        // ================= PRODUTOS =================
        async function carregarProdutos() {
            try {
                const response = await fetch(`${CONFIG.API_URL}/produtos`);
                produtos = await response.json();
                
                let html = '<table><tr><th>ID</th><th>Nome</th><th>Estoque</th><th>Pre√ßo</th><th>A√ß√µes</th></tr>';
                produtos.forEach(prod => {
                    html += `
                        <tr>
                            <td>${prod.id}</td>
                            <td>${prod.nome}</td>
                            <td>${prod.quantidade}</td>
                            <td>R$ ${prod.valor_venda.toFixed(2)}</td>
                            <td>
                                <button onclick="venderProduto(${prod.id})" style="padding: 5px 10px;">Vender</button>
                                <button onclick="excluirProduto(${prod.id})" style="padding: 5px 10px;" class="btn-danger">Excluir</button>
                            </td>
                        </tr>
                    `;
                });
                html += '</table>';
                document.getElementById('listaProdutos').innerHTML = html;
                
            } catch (error) {
                console.error('Erro produtos:', error);
                document.getElementById('listaProdutos').innerHTML = 'Erro ao carregar produtos';
            }
        }
        
        async function cadastrarProduto() {
            const nome = document.getElementById('produtoNome').value;
            const quantidade = document.getElementById('produtoQuantidade').value;
            const preco = document.getElementById('produtoPreco').value;
            
            if (!nome || !preco) {
                showAlert('error', 'Preencha nome e pre√ßo');
                return;
            }
            
            try {
                const response = await fetch(`${CONFIG.API_URL}/produtos`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        nome, 
                        quantidade: parseInt(quantidade) || 0, 
                        valor_venda: parseFloat(preco) 
                    })
                });
                
                const novoProduto = await response.json();
                showAlert('success', `Produto "${novoProduto.nome}" cadastrado!`);
                
                // Limpa formul√°rio
                document.getElementById('produtoNome').value = '';
                document.getElementById('produtoQuantidade').value = '0';
                document.getElementById('produtoPreco').value = '';
                
                // Atualiza lista
                carregarProdutos();
                carregarDashboard('hoje');
                
            } catch (error) {
                console.error('Erro cadastro:', error);
                showAlert('error', 'Erro ao cadastrar produto');
            }
        }
        
        async function excluirProduto(id) {
            if (!confirm('Excluir este produto?')) return;
            
            // Em uma API real, aqui seria DELETE
            showAlert('info', 'Funcionalidade de exclus√£o via API em desenvolvimento');
        }
        
        // ================= VENDAS =================
        async function carregarProdutosParaVenda() {
            try {
                const response = await fetch(`${CONFIG.API_URL}/produtos`);
                produtos = await response.json();
                
                const select = document.getElementById('vendaProduto');
                select.innerHTML = '<option value="">Selecione um produto</option>';
                
                produtos.forEach(prod => {
                    if (prod.quantidade > 0) {
                        const option = document.createElement('option');
                        option.value = prod.id;
                        option.textContent = `${prod.nome} - R$ ${prod.valor_venda.toFixed(2)} (Estoque: ${prod.quantidade})`;
                        option.dataset.preco = prod.valor_venda;
                        select.appendChild(option);
                    }
                });
                
            } catch (error) {
                console.error('Erro carregar produtos:', error);
            }
        }
        
        function selecionarProduto() {
            const select = document.getElementById('vendaProduto');
            const produtoId = select.value;
            const produto = produtos.find(p => p.id == produtoId);
            
            if (produto) {
                document.getElementById('vendaPrecoUnitario').value = `R$ ${produto.valor_venda.toFixed(2)}`;
                calcularTotalVenda();
            }
        }
        
        function calcularTotalVenda() {
            const select = document.getElementById('vendaProduto');
            const quantidade = document.getElementById('vendaQuantidade').value;
            const produto = produtos.find(p => p.id == select.value);
            
            if (produto) {
                const total = produto.valor_venda * quantidade;
                document.getElementById('vendaTotal').value = `R$ ${total.toFixed(2)}`;
            }
        }
        
        async function registrarVenda() {
            const select = document.getElementById('vendaProduto');
            const produtoId = select.value;
            const quantidade = document.getElementById('vendaQuantidade').value;
            
            if (!produtoId || !quantidade) {
                showAlert('error', 'Selecione produto e quantidade');
                return;
            }
            
            const produto = produtos.find(p => p.id == produtoId);
            if (!produto) {
                showAlert('error', 'Produto n√£o encontrado');
                return;
            }
            
            if (produto.quantidade < quantidade) {
                showAlert('error', `Estoque insuficiente! Dispon√≠vel: ${produto.quantidade}`);
                return;
            }
            
            try {
                const response = await fetch(`${CONFIG.API_URL}/vendas`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        produto_id: produtoId,
                        produto_nome: produto.nome,
                        quantidade: parseInt(quantidade),
                        valor_unitario: produto.valor_venda
                    })
                });
                
                const novaVenda = await response.json();
                showAlert('success', `Venda registrada! Total: R$ ${novaVenda.valor_total.toFixed(2)}`);
                
                // Limpa formul√°rio
                document.getElementById('vendaProduto').value = '';
                document.getElementById('vendaQuantidade').value = '1';
                document.getElementById('vendaPrecoUnitario').value = '';
                document.getElementById('vendaTotal').value = '';
                
                // Atualiza dados
                carregarVendas();
                carregarDashboard('hoje');
                carregarProdutosParaVenda();
                
            } catch (error) {
                console.error('Erro venda:', error);
                showAlert('error', 'Erro ao registrar venda');
            }
        }
        
        async function carregarVendas() {
            try {
                const response = await fetch(`${CONFIG.API_URL}/vendas`);
                const vendas = await response.json();
                
                let html = '<table><tr><th>Data</th><th>Produto</th><th>Qtd</th><th>Total</th></tr>';
                vendas.forEach(venda => {
                    const data = new Date(venda.data_venda).toLocaleDateString('pt-BR');
                    html += `
                        <tr>
                            <td>${data}</td>
                            <td>${venda.produto_nome}</td>
                            <td>${venda.quantidade}</td>
                            <td>R$ ${venda.valor_total.toFixed(2)}</td>
                        </tr>
                    `;
                });
                html += '</table>';
                document.getElementById('listaVendas').innerHTML = html;
                
            } catch (error) {
                console.error('Erro vendas:', error);
                document.getElementById('listaVendas').innerHTML = 'Erro ao carregar vendas';
            }
        }
        
        function venderProduto(produtoId) {
            showPage('vendas');
            document.getElementById('vendaProduto').value = produtoId;
            selecionarProduto();
        }
        
        // ================= UTILIT√ÅRIOS =================
        function sincronizar() {
            carregarDashboard('hoje');
            carregarProdutos();
            carregarVendas();
            showAlert('success', 'Dados sincronizados');
        }
        
        // ================= INICIALIZA√á√ÉO =================
        document.addEventListener('DOMContentLoaded', function() {
            carregarDashboard('hoje');
            document.getElementById('vendaQuantidade').addEventListener('input', calcularTotalVenda);
        });
    </script>
</body>
  </html>
